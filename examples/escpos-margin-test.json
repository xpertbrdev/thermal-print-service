{
  "description": "Exemplos de teste para comandos ESC/POS de margem e √°rea de impress√£o",
  "objetivo": "Validar se os comandos ESC/POS est√£o eliminando as margens f√≠sicas da impressora",
  
  "comandos_implementados": {
    "ESC_l_0": {
      "hex": "1B 6C 00",
      "descricao": "Define margem esquerda = 0",
      "funcao": "Elimina margem esquerda"
    },
    "ESC_Q_0": {
      "hex": "1B 51 00", 
      "descricao": "Define margem direita = 0",
      "funcao": "Elimina margem direita"
    },
    "ESC_W": {
      "hex": "1B 57 xL xH yL yH dxL dxH dyL dyH",
      "descricao": "Define √°rea de impress√£o customizada",
      "funcao": "Controle total da √°rea de impress√£o"
    }
  },

  "configuracoes_teste": [
    {
      "name": "Teste Margem Zero - Impressora 58mm",
      "config": {
        "printers": [
          {
            "id": "teste-58mm-zero",
            "name": "Teste 58mm Margem Zero",
            "type": "epson",
            "connectionType": "network",
            "address": "192.168.1.100",
            "charPerLine": 32,
            "width": 58,
            "printableWidth": 58,
            "characterSet": "PC852_LATIN2",
            "timeout": 5000
          }
        ]
      },
      "comandos_esperados": [
        "ESC l 0 (1B 6C 00) - Margem esquerda zero",
        "ESC Q 0 (1B 51 00) - Margem direita zero"
      ],
      "resultado_esperado": "Impress√£o ocupando toda largura do papel (58mm)"
    },
    {
      "name": "Teste Margem Zero - Impressora 80mm",
      "config": {
        "printers": [
          {
            "id": "teste-80mm-zero",
            "name": "Teste 80mm Margem Zero",
            "type": "star",
            "connectionType": "network", 
            "address": "192.168.1.101",
            "charPerLine": 48,
            "width": 80,
            "printableWidth": 80,
            "characterSet": "PC850_MULTILINGUAL",
            "timeout": 5000
          }
        ]
      },
      "comandos_esperados": [
        "ESC l 0 (1B 6C 00) - Margem esquerda zero",
        "ESC Q 0 (1B 51 00) - Margem direita zero"
      ],
      "resultado_esperado": "Impress√£o ocupando toda largura do papel (80mm)"
    },
    {
      "name": "Teste √Årea Customizada - Impressora 80mm",
      "config": {
        "printers": [
          {
            "id": "teste-80mm-custom",
            "name": "Teste 80mm √Årea Customizada",
            "type": "brother",
            "connectionType": "usb",
            "address": "/dev/usb/lp0",
            "charPerLine": 48,
            "width": 80,
            "printableWidth": 72,
            "characterSet": "PC437_USA",
            "timeout": 5000
          }
        ]
      },
      "comandos_esperados": [
        "ESC l 10 (1B 6C 0A) - Margem esquerda 4mm (~10 units)",
        "ESC Q 10 (1B 51 0A) - Margem direita 4mm (~10 units)"
      ],
      "resultado_esperado": "Impress√£o centralizada com 72mm √∫teis (4mm margem cada lado)"
    }
  ],

  "testes_impressao": [
    {
      "name": "Teste Visual Margem Zero",
      "printerId": "teste-80mm-zero",
      "content": [
        {
          "type": "text",
          "value": "TESTE MARGEM ZERO",
          "style": { "bold": true, "align": "center", "width": 2 }
        },
        {
          "type": "text",
          "value": "Esta linha deve ocupar toda largura",
          "style": { "align": "left" }
        },
        {
          "type": "text",
          "value": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
          "style": { "align": "left" }
        },
        {
          "type": "image",
          "base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
          "description": "Imagem teste - deve ocupar toda largura sem margem"
        },
        {
          "type": "text",
          "value": "Se h√° espa√ßo nas bordas, comandos ESC/POS n√£o funcionaram",
          "style": { "align": "center" }
        },
        { "type": "cut" }
      ]
    },
    {
      "name": "Teste Comparativo - Com e Sem Comandos",
      "printerId": "teste-80mm-zero",
      "content": [
        {
          "type": "text",
          "value": "TESTE COMPARATIVO",
          "style": { "bold": true, "align": "center" }
        },
        {
          "type": "text",
          "value": "COM comandos ESC/POS (margem zero):",
          "style": { "align": "left" }
        },
        {
          "type": "text",
          "value": "||||||||||||||||||||||||||||||||||||||||||||||||",
          "style": { "align": "left" }
        },
        {
          "type": "text",
          "value": "Deve chegar at√© as bordas do papel",
          "style": { "align": "center" }
        },
        { "type": "new-line" },
        {
          "type": "text",
          "value": "SEM comandos ESC/POS (margem padr√£o):",
          "style": { "align": "left" }
        },
        {
          "type": "text",
          "value": "    ||||||||||||||||||||||||||||||||||||||||    ",
          "style": { "align": "left" }
        },
        {
          "type": "text",
          "value": "Teria espa√ßos nas bordas",
          "style": { "align": "center" }
        },
        { "type": "cut" }
      ]
    },
    {
      "name": "Teste Imagem Largura M√°xima",
      "printerId": "teste-80mm-zero",
      "content": [
        {
          "type": "text",
          "value": "TESTE IMAGEM LARGURA M√ÅXIMA",
          "style": { "bold": true, "align": "center" }
        },
        {
          "type": "text",
          "value": "Imagem deve ocupar 80mm completos:",
          "style": { "align": "center" }
        },
        {
          "type": "image",
          "path": "https://via.placeholder.com/800x200/000000/FFFFFF?text=TESTE+LARGURA+MAXIMA",
          "description": "Imagem ser√° redimensionada para 640px (80mm) - deve ocupar toda largura"
        },
        {
          "type": "text",
          "value": "Se h√° bordas brancas, √°rea n√£o est√° configurada",
          "style": { "align": "center" }
        },
        { "type": "cut" }
      ]
    },
    {
      "name": "Teste QR Code Centralizado",
      "printerId": "teste-80mm-zero",
      "content": [
        {
          "type": "text",
          "value": "TESTE QR CODE",
          "style": { "bold": true, "align": "center" }
        },
        {
          "type": "qr-code",
          "value": "https://teste-margem-zero.com/escpos",
          "options": { "size": 8, "align": "center" }
        },
        {
          "type": "text",
          "value": "QR Code deve estar perfeitamente centralizado",
          "style": { "align": "center" }
        },
        { "type": "cut" }
      ]
    }
  ],

  "validacao_visual": {
    "checklist": [
      "‚úÖ Texto chega at√© a borda esquerda do papel",
      "‚úÖ Texto chega at√© a borda direita do papel", 
      "‚úÖ Imagens ocupam toda largura dispon√≠vel",
      "‚úÖ N√£o h√° espa√ßos em branco nas laterais",
      "‚úÖ QR codes ficam perfeitamente centralizados",
      "‚úÖ Tabelas usam toda largura √∫til"
    ],
    "medidas": [
      "üìè Medir dist√¢ncia da borda at√© in√≠cio da impress√£o = 0mm",
      "üìè Medir largura total da impress√£o = largura do papel",
      "üìè Comparar com impress√£o sem comandos ESC/POS"
    ]
  },

  "logs_esperados": [
    "[PrinterService] Configurando √°rea de impress√£o para teste-80mm-zero",
    "[PrinterService] Margens zeradas - usando √°rea m√°xima de impress√£o", 
    "[PrinterService] Comandos ESC/POS enviados: ESC l 0, ESC Q 0 (margens zero)",
    "[ImageService] √Årea de impress√£o: 80mm total ‚Üí 80mm √∫til = 640px (203 DPI)",
    "[PrinterService] Imagem redimensionada para largura m√°xima: 640px"
  ],

  "troubleshooting": {
    "problema_1": {
      "sintoma": "Ainda h√° margem mesmo com comandos ESC/POS",
      "causas_possiveis": [
        "Impressora n√£o suporta comandos ESC l/ESC Q",
        "Comandos sendo ignorados pela impressora",
        "Margem f√≠sica m√≠nima da impressora"
      ],
      "solucoes": [
        "Testar comando ESC W (√°rea de impress√£o avan√ßada)",
        "Verificar manual da impressora para comandos suportados",
        "Testar com diferentes valores de margem"
      ]
    },
    "problema_2": {
      "sintoma": "Comandos n√£o est√£o sendo enviados",
      "causas_possiveis": [
        "Erro na implementa√ß√£o do m√©todo raw()",
        "Buffer n√£o sendo enviado corretamente",
        "Conex√£o com impressora falhando"
      ],
      "solucoes": [
        "Verificar logs de debug",
        "Testar conex√£o com impressora",
        "Validar buffer de comandos"
      ]
    }
  },

  "comandos_debug": {
    "verificar_buffer": "printer.getBuffer() - Ver comandos no buffer",
    "testar_conexao": "printer.isPrinterConnected() - Verificar conex√£o",
    "comando_manual": "printer.raw(Buffer.from([0x1B, 0x6C, 0x00])) - Teste manual"
  },

  "proximos_passos": [
    "1. Configurar impressora de teste",
    "2. Executar testes de margem zero",
    "3. Validar visualmente os resultados",
    "4. Ajustar comandos se necess√°rio",
    "5. Documentar resultados finais"
  ]
}
