{
  "info": {
    "name": "Thermal Printer Microservice - API Completa",
    "description": "Collection completa do microservice de impressão térmica com todas as funcionalidades implementadas",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "thermal-printer-complete-api"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "printerId",
      "value": "cozinha-1",
      "type": "string"
    },
    {
      "key": "sessionId",
      "value": "",
      "type": "string"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "const now = new Date();",
          "const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, 19);",
          "pm.collectionVariables.set('timestamp', timestamp);",
          "",
          "if (!pm.collectionVariables.get('sessionId')) {",
          "    const sessionId = 'sess_' + timestamp + '_' + Math.random().toString(36).substr(2, 5);",
          "    pm.collectionVariables.set('sessionId', sessionId);",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "1. CONFIGURAÇÃO",
      "item": [
        {
          "name": "Configurar Impressoras",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"printers\": [\n    {\n      \"id\": \"cozinha-1\",\n      \"name\": \"Impressora Cozinha 80mm\",\n      \"type\": \"epson\",\n      \"connectionType\": \"network\",\n      \"address\": \"192.168.1.100\",\n      \"charPerLine\": 48,\n      \"width\": 80,\n      \"printableWidth\": 80,\n      \"characterSet\": \"PC852_LATIN2\",\n      \"timeout\": 5000\n    },\n    {\n      \"id\": \"balcao-1\",\n      \"name\": \"Impressora Balcão 58mm\",\n      \"type\": \"epson\",\n      \"connectionType\": \"network\",\n      \"address\": \"192.168.1.101\",\n      \"charPerLine\": 32,\n      \"width\": 58,\n      \"printableWidth\": 58,\n      \"characterSet\": \"PC852_LATIN2\",\n      \"timeout\": 5000\n    }\n  ],\n  \"defaultSettings\": {\n    \"charPerLine\": 48,\n    \"width\": 80,\n    \"printableWidth\": 80,\n    \"characterSet\": \"PC852_LATIN2\",\n    \"timeout\": 5000\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/config",
              "host": ["{{baseUrl}}"],
              "path": ["config"]
            }
          }
        },
        {
          "name": "Consultar Configurações",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/config",
              "host": ["{{baseUrl}}"],
              "path": ["config"]
            }
          }
        },
        {
          "name": "Listar Impressoras",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/config/printers",
              "host": ["{{baseUrl}}"],
              "path": ["config", "printers"]
            }
          }
        },
        {
          "name": "Detalhes da Impressora",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/config/printers/{{printerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["config", "printers", "{{printerId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "2. IMPRESSÃO COM SESSÕES",
      "item": [
        {
          "name": "Impressão Completa",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.sessionId) {",
                  "        pm.collectionVariables.set('sessionId', response.sessionId);",
                  "        console.log('SessionId capturado:', response.sessionId);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"printerId\": \"{{printerId}}\",\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"value\": \"PEDIDO #1234\",\n      \"style\": {\n        \"bold\": true,\n        \"align\": \"center\",\n        \"width\": 2,\n        \"height\": 2\n      }\n    },\n    {\n      \"type\": \"line\",\n      \"character\": \"=\",\n      \"length\": 48\n    },\n    {\n      \"type\": \"table\",\n      \"table\": {\n        \"headers\": [\"Item\", \"Qtd\", \"Valor\"],\n        \"rows\": [\n          {\"cells\": [\"Pizza Margherita\", \"1\", \"R$ 35,00\"]},\n          {\"cells\": [\"Refrigerante 350ml\", \"2\", \"R$ 12,00\"]}\n        ],\n        \"columns\": [\n          {\"width\": 24, \"align\": \"left\"},\n          {\"width\": 4, \"align\": \"center\"},\n          {\"width\": 12, \"align\": \"right\"}\n        ],\n        \"separator\": \" | \",\n        \"borderChar\": \"-\"\n      }\n    },\n    {\n      \"type\": \"qr-code\",\n      \"value\": \"https://exemplo.com/pedido/1234\",\n      \"options\": {\n        \"size\": 6,\n        \"align\": \"center\"\n      }\n    },\n    {\n      \"type\": \"barcode\",\n      \"value\": \"1234567890\",\n      \"options\": {\n        \"type\": \"CODE128\",\n        \"width\": 2,\n        \"height\": 100,\n        \"align\": \"center\"\n      }\n    },\n    {\"type\": \"cut\"}\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/print/session",
              "host": ["{{baseUrl}}"],
              "path": ["print", "session"]
            }
          }
        },
        {
          "name": "Impressão com Imagem Base64",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"printerId\": \"{{printerId}}\",\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"value\": \"LOGO DA EMPRESA\",\n      \"style\": {\"bold\": true, \"align\": \"center\"}\n    },\n    {\n      \"type\": \"image\",\n      \"base64\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==\"\n    },\n    {\n      \"type\": \"text\",\n      \"value\": \"Imagem otimizada automaticamente\",\n      \"style\": {\"align\": \"center\"}\n    },\n    {\"type\": \"cut\"}\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/print/session",
              "host": ["{{baseUrl}}"],
              "path": ["print", "session"]
            }
          }
        }
      ]
    },
    {
      "name": "3. MONITORAMENTO",
      "item": [
        {
          "name": "Status da Sessão",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/print/status/{{sessionId}}",
              "host": ["{{baseUrl}}"],
              "path": ["print", "status", "{{sessionId}}"]
            }
          }
        },
        {
          "name": "Dashboard Completo",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/monitoring/dashboard",
              "host": ["{{baseUrl}}"],
              "path": ["monitoring", "dashboard"]
            }
          }
        },
        {
          "name": "Fila da Impressora",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/print/queue/{{printerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["print", "queue", "{{printerId}}"]
            }
          }
        },
        {
          "name": "Cancelar Sessão",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/print/cancel/{{sessionId}}",
              "host": ["{{baseUrl}}"],
              "path": ["print", "cancel", "{{sessionId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "4. TESTES ESC/POS",
      "item": [
        {
          "name": "Testar Margem Zero - 80mm",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/escpos-test/margin/80?printableWidth=80",
              "host": ["{{baseUrl}}"],
              "path": ["escpos-test", "margin", "80"],
              "query": [
                {
                  "key": "printableWidth",
                  "value": "80"
                }
              ]
            }
          }
        },
        {
          "name": "Comparar Buffers",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/escpos-test/compare-buffers",
              "host": ["{{baseUrl}}"],
              "path": ["escpos-test", "compare-buffers"]
            }
          }
        },
        {
          "name": "Validar Integração",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/escpos-test/validate/{{printerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["escpos-test", "validate", "{{printerId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "5. UTILITÁRIOS",
      "item": [
        {
          "name": "Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Serviço está funcionando', function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json().status).to.eql('ok');",
                  "});",
                  "",
                  "console.log('✅ Microservice está online!');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/print/health",
              "host": ["{{baseUrl}}"],
              "path": ["print", "health"]
            }
          }
        },
        {
          "name": "Teste de Conexão",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/print/test-connection?printerId={{printerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["print", "test-connection"],
              "query": [
                {
                  "key": "printerId",
                  "value": "{{printerId}}"
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
